<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pawartos Lelayu</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<body class="bg-light">
    <div id="loginSection" class="container py-5">
        <div class="card shadow-sm">
            <div class="card-body text-center">
                <h3>Masukkan Password</h3>
                <input type="password" id="passwordInput" class="form-control d-inline text-center mb-3" style="width: auto; display: inline;" placeholder="Password">
                <button class="btn btn-primary btn-sm" onclick="checkPassword()">Masuk</button>
                <p id="errorMessage" class="text-danger mt-2" style="display: none;">Password salah, coba lagi.</p>
            </div>
        </div>
    </div>

    <div id="mainContent" style="display: none;">
        <div class="container py-5">
            <div class="card shadow-sm">
                <div class="card-header text-center" style="border-bottom: 2px solid #000000;">
                    <img src="logo.png" alt="Logo" style="width: 100px; height: 100px; margin-bottom: 10px;">
                    <h2>KARANG TARUNA UNIT</h2>
                    <h1>RUKUN AGAWE SANTOSA (RAS)</h1>
                    <p class="mb-0">Jl. Parangtritis Km 6,5 Ngijo Dk. Demangan Bangunharjo Sewon Bantul</p>
                </div>
                <div class="card-body">
                    <h2 class="text-center mb-2">PAWARTOS LELAYU</h2>

                    <div class="mb-3">
                        <strong>Katur Panjenengan:</strong> .............................................
                    </div>

                    <div class="mb-3">
                        <strong>Wonten Ing:</strong> ................................................
                    </div>

                    <p>Assalamu'alaikum Wr. Wb.<br>
                    Innalillahi Wa Innaillaihi Roji'un<br>
                    Sampun katimbalan sowan wonten ing Ngarsa Dalem Gusti Allah SWT, inggih punika:</p>

                    <div class="text-center mb-4">
                        <form class="d-inline">
                            <input type="text" id="inputAlmarhum" value="Bapak /Ibu......" class="form-control d-inline text-center" style="width: auto; display: inline;">
                            <span class="text-muted">(dapat diubah)</span>
                        </form>
                    </div>

                    <div class="text-center mb-4">
                        <form class="d-inline">
                            <label for="inputYuswo" class="form-label me-2">Yuswo:</label>
                            <input type="text" id="inputYuswo" value="60 Tahun" class="form-control d-inline text-center" style="width: auto; display: inline;">
                            <span class="text-muted">(dapat diubah)</span>
                        </form>
                    </div>

                    <div class="mb-3">
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Pidalem:</strong>
                            <input type="text" id="inputPidalem" value="Ngijo Demangan RT. 01 Bangunharjo, Sewon, Bantul" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Dinten:</strong>
                            <input type="text" id="inputDinten" value="Kamis Pahing, 20 November 2025" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Wanci:</strong>
                            <input type="text" id="inputWanci" value="07.30 WIB" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Wonten Ing:</strong>
                            <input type="text" id="inputWontenIng" value="Ngijo Demangan RT. 01 Bangunharjo, Sewon, Bantul" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <p><strong>Jenazah Badhe Kasarekaken:</strong></p>
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Dinten:</strong>
                            <input type="text" id="inputDinten2" value="Kamis Pahing, 20 November 2025" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Wanci:</strong>
                            <input type="text" id="inputWanci2" value="16.00 WIB" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                        <div class="mb-3 d-flex align-items-center">
                            <strong class="me-2">Wonten Ing:</strong>
                            <input type="text" id="inputWontenIng2" value="Makam Ngijo Sisih Lor" class="form-control" style="width: auto;">
                            <span class="text-muted ms-2">(dapat diubah)</span>
                        </div>
                    </div>

                    <p>Awit saking meniko dumateng para Bapak/Ibu/Saudara mbok bilih mboten wonten alangan satunggal punopo, kasuwun rawuhipun saperlu paring Do'a soho derek belo sungkowo soho paring pangumatan ingkang pungkasan dumateng Almarhum.</p>
                    <p>Wassalamu'alaikum Wr. Wb.</p>
                </div>
                <div class="card-footer text-center">
                     <p><strong>Ahli Waris:</strong></p>
                    <div class="row justify-content-center" id="ahliWarisContainer">
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="Nama Ahli Waris" id="inputWaris1">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="(Suami/Istri/Menantu-Anak)" id="inputHubungan1">
                        </div>
                    </div>
                    <div class="text-center mt-3" id="addRemoveButtons">
                        <button class="btn btn-info btn-sm" onclick="addColumn()">Tambah Kolom</button>
                        <button class="btn btn-primary btn-sm" onclick="showPreviewPopup()">Preview</button>
                        <button class="btn btn-danger btn-sm" onclick="removeColumn()">Hapus Kolom</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Preview -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content
">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewModalLabel">Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="previewContent">
                    <div class="text-start">
                        <img src="logo.png" alt="Logo" style="width: 80px; height: 80px; margin-bottom: 10px; position: absolute; top: 10px; left: 10px;">
                    </div>
                    <div class="text-center">
                        <h2>KARANG TARUNA UNIT</h2>
                        <h1>RUKUN AGAWE SANTOSA (RAS)</h1>
                        <p>Jl. Parangtritis Km 6,5 Ngijo Dk. Demangan Bangunharjo Sewon Bantul</p>
                        <hr>
                        <h2>PAWARTOS LELAYU</h2>
                    </div>
                    <!-- Preview content will be dynamically inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kembali</button>
                    <button type="button" class="btn btn-success" onclick="printPage()">Print</button>
                    <button type="button" class="btn btn-primary" onclick="exportPdf()">Ekspor ke PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        const correctPassword = "12345";

        function checkPassword() {
            const enteredPassword = document.getElementById("passwordInput").value;
            if (enteredPassword === correctPassword) {
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("mainContent").style.display = "block";
            } else {
                document.getElementById("errorMessage").style.display = "block";
            }
        }

        function addColumn() {
            const row = document.getElementById('ahliWarisContainer');
            const newColumn = document.createElement('div');
            newColumn.className = 'col-md-3';
            newColumn.innerHTML = `<input type="text" class="form-control" placeholder="Nama Ahli Waris" id="inputWaris${row.children.length + 1}">`;
            const newHubungan = document.createElement('div');
            newHubungan.className = 'col-md-3';
            newHubungan.innerHTML = `<input type="text" class="form-control" placeholder="Hubungan" id="inputHubungan${row.children.length + 1}">`;
            row.appendChild(newColumn);
            row.appendChild(newHubungan);
        }

        function removeColumn() {
            const row = document.getElementById('ahliWarisContainer');
            if (row.children.length > 2) {
                row.removeChild(row.lastElementChild); // Remove Hubungan column
                row.removeChild(row.lastElementChild); // Remove Nama Ahli Waris column
            }
        }

        function showPreviewPopup() {
            const almarhum = document.getElementById("inputAlmarhum").value;
            const yuswo = document.getElementById("inputYuswo").value;
            const pidalem = document.getElementById("inputPidalem").value;
            const dinten = document.getElementById("inputDinten").value;
            const wanci = document.getElementById("inputWanci").value;
            const dinten2 = document.getElementById("inputDinten2").value;
            const wanci2 = document.getElementById("inputWanci2").value;
            const wonten = document.getElementById("inputWontenIng").value;
            const wontenIng2 = document.getElementById("inputWontenIng2").value;

            let content = `
            <div class="card-header d-flex align-items-center" style="border-bottom: 2px solid #000000;">
                <img src="logo.png" alt="Logo" style="width: 100px; height: 100px; margin-right: 15px;">
                <div class="text-center flex-grow-1">
                    <h2 style="font-size: 20px;">KARANG TARUNA UNIT</h2>
                    <h1 style="font-size: 35px;">RUKUN AGAWE SANTOSA (RAS)</h1>
                    <p class="mb-0">Jl. Parangtritis Km 6,5 Ngijo Dk. Demangan Bangunharjo Sewon Bantul</p>
                </div>
            </div>
                <h2><center>PAWARTOS LELAYU</center></h2>
                </div>
               <div id="previewContent" style="line-height: 0.8;">
                    <p class="text-end" class="mb-0">Katur Panjenengan: .............................................</p>
                    <p class="text-end" class="mb-0">Wonten Ing: ................................................</p>
                    <p>Assalamu'alaikum Wr. Wb.</p>
                    <p style="text-indent: 40px;">Innalillahi Wa Innaillaihi Roji'un</p>
                    <p>Sampun katimbalan sowan wonten ing Ngarsa Dalem Gusti Allah SWT, inggih punika:</p>
                    <p><center><strong>Almarhum:</strong> ${almarhum}</center></p>
                    <p><center><strong>Yuswo:</strong> ${yuswo}</center></p>
                    <p><strong>Pidalem:</strong> ${pidalem}</p>
                    <p><strong>Dinten:</strong> ${dinten}</p>
                    <p><strong>Wanci:</strong> ${wanci}</p>
                    <p><strong>Wonten Ing:</strong> ${wonten}</p>
                    <p style="text-indent: 40px;"><strong>Jenazah Badhe Kasarekaken:</strong></p>
                    <p><strong>Dinten:</strong> ${dinten2}</p>
                    <p><strong>Wanci:</strong> ${wanci2}</p>
                    <p><strong>Wonten Ing:</strong> ${wontenIng2}</p>
                    <p style="text-indent: 40px;">Awit saking meniko dumateng para Bapak/Ibu/Saudara mbok bilih mboten
                    wonten alangan satunggal</p><p> punopo,kasuwun rawuhipun saperlu paring Do'a soho 
                    derek belo sungkowo soho paring pangumatan</p>
                    <p>ingkang pungkasan dumateng Almarhum.</p>
                    <p>Wassalamu'alaikum Wr. Wb.</p>
                </div>
            `;

            const ahliWarisContainer = document.getElementById("ahliWarisContainer");
            content += `<p class="text-center"><strong>Ahli Waris:</strong></p>`;

            for (let i = 0; i < ahliWarisContainer.children.length; i += 2) {
                const namaWaris = ahliWarisContainer.children[i].querySelector("input").value;
                const hubunganWaris = ahliWarisContainer.children[i + 1].querySelector("input").value;

                content += `<p><center><strong>${namaWaris}</strong> (${hubunganWaris})</center></p>`;
            }

            document.getElementById("previewContent").innerHTML = content;
            const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
            previewModal.show();
        }

        function exportPdf() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById("previewContent");

            html2canvas(element, { scale: 2, useCORS: true }).then((canvas) => {
                const imgData = canvas.toDataURL("image/png");
                const pdf = new jsPDF({ unit: "mm", format: "a4" });
                const imgWidth = 210; // Lebar halaman A4 dalam mm
                const pageHeight = 297; // Tinggi halaman A4 dalam mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                // Tambahkan halaman pertama
                pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // Tambahkan halaman berikutnya jika konten melebihi tinggi satu halaman
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // Simpan PDF
                pdf.save("pawartos-lelayu.pdf");
            }).catch((error) => {
                console.error("Error generating PDF:", error);
                alert("Terjadi kesalahan saat membuat PDF. Periksa log konsol untuk detail lebih lanjut.");
            });
        }

        function printPage() {
            const printContent = document.getElementById("previewContent").innerHTML;
            const originalContent = document.body.innerHTML;
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }
    </script>
</body>
</html>
